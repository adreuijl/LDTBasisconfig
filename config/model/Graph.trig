@prefix elmo: <http://dotwebstack.org/def/elmo#> . 
@prefix elmo-rt: <http://dotwebstack.org/def/elmo/result-type/>. 
@prefix elmo-ps: <http://dotwebstack.org/def/elmo/persistence-strategy/>. 
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> . 
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> . 
@prefix config: <http://dotwebstack.org/configuration/>. 
@prefix sh: <http://www.w3.org/ns/shacl#>. 
@prefix dbo: <http://dbpedia.org/ontology/>. 
@prefix xhtml: <http://www.w3.org/1999/xhtml/vocab#>. 
@prefix http: <http://www.w3.org/2011/http#>. 
@prefix dc: <http://purl.org/dc/elements/1.1/>. 
@prefix skos: <http://www.w3.org/2004/02/skos/core#>.
@prefix thes: <http://purl.org/iso25964/skos-thes#>.
@prefix dct: <http://purl.org/dc/terms/>.
 

GRAPH config:Theatre { 

  config:GraphDisplayEndpoint a elmo:Representation;
    elmo:pathPattern "/resource"; # Hack
    elmo:stage config:Stage;
    elmo:informationProduct config:ConceptenDetailGraph;
  .

  config:GraphDisplay a elmo:Representation;
    elmo:stage config:Stage;
    elmo:appearance config:ConceptenGraphAppearance;
    elmo:informationProduct config:ConceptenDetailGraph;
  .
  
  config:ConceptenGraphAppearance a elmo:GraphAppearance;
    elmo:fragment [
	  elmo:appliesTo "begrip";
	  xhtml:stylesheet '''
	    fill: blue;
		fill-opacity: .3;
		stroke #666;
	  ''';
	  elmo:index 1;
	];
	elmo:fragment [
	  elmo:appliesTo "domeintabel";
	  xhtml:stylesheet '''
	    fill: yellow;
		fill-opacity: .3;
		stroke #666;
	  ''';
	  elmo:index 2;
	];
  .

  config:ConceptenDetailGraph a elmo:InformationProduct;
    elmo:requiredParameter config:ConceptTabelParameter;
    elmo:backend config:LocalBackend;
    elmo:query """
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#> 
      PREFIX skos: <http://www.w3.org/2004/02/skos/core#> 
	  PREFIX thes: <http://purl.org/iso25964/skos-thes#>
	  PREFIX dct: <http://purl.org/dc/terms/>
	  CONSTRUCT {
		?subject ?p ?o.
		?subject rdfs:label ?begriplabel.
		?subject elmo:style ?type.
		
		?o rdfs:label ?olabel.
		?o elmo:style ?oelmostyle.
		
		?s ?sp ?subject.
		?s rdfs:label ?slabel.
		?s elmo:style ?selmostyle.
		
		skos:Concept elmo:name "begrip".
		dct:subject rdfs:label "Categorie".
		skos:broader rdfs:label "Bredere term".
		skos:narrower rdfs:label "Nauwere term".
		skos:related rdfs:label "Gerelateerd term".
		thes:broaderPartitive "Onderdeel van".
		thes:narrowerPartitive "Heeft onderdeel".
		dct:isReplacedBy rdfs:label "Gebruik".
		dct:replaces rdfs:label "Gebruik in plaats van".
		}
        WHERE {
		  GRAPH <http://data.aquo.nl/id/dataset/begrippen> {
				?subject rdf:type ?type.
				OPTIONAL
				{
				  ?subject rdfs:label ?subjectlabel.
				}
				OPTIONAL
				{
				  ?subject ?p ?o.
				  FILTER (
				    ?p = dct:subject
					||?p = skos:broader
					||?p = skos:narrower
					||?p = skos:related
					||?p = thes:broaderPartitive
					||?p = thes:narrowerPartitive
					||?p = dct:isReplacedBy
					||?p = dct:replaces
				  )
				}
				UNION
				{
				  ?subject ?p ?o.
				  ?o rdfs:label ?olabel.
				  ?o rdf:type ?otype.
				}
				UNION
				{
				  ?s ?sp ?subject.
				  ?s rdfs:label ?slabel.
				  ?s rdf:type ?stype.
				}
			  }
			}
      """
    .
}
