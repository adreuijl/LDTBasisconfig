@prefix elmo: <http://dotwebstack.org/def/elmo#> .
@prefix elmo-rt: <http://dotwebstack.org/def/elmo/result-type/>.
@prefix elmo-ps: <http://dotwebstack.org/def/elmo/persistence-strategy/>.
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix config: <http://dotwebstack.org/configuration/>.
@prefix sh: <http://www.w3.org/ns/shacl#>.
@prefix dbo: <http://dbpedia.org/ontology/>.
@prefix xhtml: <http://www.w3.org/1999/xhtml/vocab#>.
@prefix http: <http://www.w3.org/2011/http#>.
@prefix dc: <http://purl.org/dc/elements/1.1/>.
@prefix skos: <http://www.w3.org/2004/02/skos/core#>.

GRAPH config:Theatre {

# ==========================
#
# Categorieen Pagina
#
# ==========================    

  config:CategorieLijst a elmo:Representation;
    elmo:pathPattern "/categorieen";
    elmo:appearance config:CategorieLijstAppearance;
    elmo:stage config:Stage;
    elmo:contains config:Menu;
    elmo:contains config:Footer;
    elmo:informationProduct config:CategorieLijstData;
  .
  config:CategorieLijstAppearance a elmo:TableAppearance;
    elmo:fragment [
      elmo:appliesTo "categorie";
      xhtml:link "/begrippen-per-categorie";
      elmo:name "categorie";
    ];
  .

  config:CategorieParameter a elmo:TermParameter;
    elmo:name "categorie"; 
	  elmo:shape [
	    sh:nodeKind sh:IRI;
		]
  .
  
  config:CategorieLijstData a elmo:InformationProduct;
    elmo:backend config:LocalBackend;
    elmo:resultType elmo-rt:Tuple;
    elmo:query """
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      PREFIX skos: <http://www.w3.org/2004/02/skos/core#>
      PREFIX dct: <http://purl.org/dc/terms/>
      SELECT ?categorie ?categorie_label (count(?begrip) as ?categorie_count)
      WHERE {
        GRAPH <http://data.aquo.nl/id/dataset/begrippen> {
          ?begrip dct:subject ?categorie.
        }
        OPTIONAL {
          GRAPH <http://data.aquo.nl/id/dataset/categorieen> {
            ?categorie rdfs:label ?categorie_label
          }
        }
      }
      group by ?categorie ?categorie_label
      order by ?categorie
    """
  .

}