GRAPH config:Theatre {

  config:DomeintabelData a elmo:InformationProduct;
    elmo:requiredParameter elmo:SubjectParameter;
    elmo:backend config:LocalBackend;
    elmo:query """
      PREFIX dct: <http://purl.org/dc/terms/>
      PREFIX prov: <http://www.w3.org/ns/prov#>
      PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
      PREFIX skos: <http://www.w3.org/2004/02/skos/core#>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      PREFIX owl:<http://www.w3.org/2002/07/owl#>
      PREFIX aquo: <http://standaard.aquo.nl/def/aquo#>

      CONSTRUCT {
        ?id ?p ?o;
             owl:sameAs ?begrip;
             skos:comment ?status;
             aquo:opgeheven ?opgehevendate;
             aquo:opgericht ?opgerichtdate.
        ?begrip rdfs:label ?begrip_label.
        ?o rdfs:label ?olabel.
      }
      WHERE {
        GRAPH ?subject {
          ?id ?p ?o;
          OPTIONAL {
            ?id aquo:Opgeheven_per ?dt;
              aquo:Opgericht_in ?odt.
            BIND(strbefore(?dt,"T") as ?opgehevendate)
            BIND(strbefore(?odt,"T") as ?opgerichtdate)
          }
          OPTIONAL {?o skos:prefLabel ?olabel}
          FILTER NOT EXISTS {
              ?id a skos:Concept.
            }
          }
        OPTIONAL {
          GRAPH <http://standaard.aquo.nl/id/dataset/links> {
            ?id owl:sameAs ?begrip
          }
          GRAPH  <http://standaard.aquo.nl/data/begrippen> {
            ?begrip skos:prefLabel ?begrip_label
          }
        }
        FILTER (
          ?p != aquo:Opgeheven_per
          && ?p != aquo:Opgericht_in
        )
      }
    """
  .

  # Mooier zou zijn als deze geintegreerd is met bovenstaande
  # Echter, op dit moment is het alleen mogelijk om groep in de subject parameter te stoppen
  # En daarmee past het niet bij het model van hierboven :-(
  config:DomeintabelGroepData a elmo:InformationProduct;
    elmo:requiredParameter elmo:SubjectParameter;
    elmo:backend config:LocalBackend;
    elmo:query """
      PREFIX dct: <http://purl.org/dc/terms/>
      PREFIX prov: <http://www.w3.org/ns/prov#>
      PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
      PREFIX skos: <http://www.w3.org/2004/02/skos/core#>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      PREFIX owl:<http://www.w3.org/2002/07/owl#>

      CONSTRUCT {
        ?id ?p ?o;
             owl:sameAs ?begrip;
             skos:comment ?status.
        ?begrip rdfs:label ?begrip_label.
        ?o rdfs:label ?olabel.
      }
      WHERE {
        GRAPH ?domeintabel {
            ?id dct:subject ?subject;
              ?p ?o.
            OPTIONAL {?o skos:prefLabel ?olabel}
            FILTER NOT EXISTS {
              ?id a skos:Concept.
            }
            FILTER NOT EXISTS {
              ?domaintabel dct:replacedBy ?newversion
            }
          }
         OPTIONAL {
          GRAPH <http://standaard.aquo.nl/id/dataset/links> {
            ?id owl:sameAs ?begrip
          }
          GRAPH  <http://standaard.aquo.nl/data/begrippen> {
            ?begrip skos:prefLabel ?begrip_label
          }
        }
      }
    """
  .

  config:DomeintabelGroepTitelData a elmo:InformationProduct;
    elmo:requiredParameter elmo:SubjectParameter;
    elmo:backend config:LocalBackend;
    elmo:query """
      PREFIX dct: <http://purl.org/dc/terms/>
      PREFIX prov: <http://www.w3.org/ns/prov#>
      PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
      PREFIX skos: <http://www.w3.org/2004/02/skos/core#>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      PREFIX owl:<http://www.w3.org/2002/07/owl#>
      PREFIX dcat: <http://www.w3.org/ns/dcat#>

      CONSTRUCT {
        ?subject dct:hasPart ?domeintabel;
          dct:subject ?subject.
        ?domeintabel rdfs:label ?domeintabel_label.
      }
      WHERE {
        GRAPH ?domeintabel {
          ?id dct:subject ?subject.
          FILTER NOT EXISTS {
            ?domaintabel dct:replacedBy ?newversion
          }
        }
        GRAPH <http://standaard.aquo.nl/data/domeintabellen> {
          <http://standaard.aquo.nl/id/dataset/domeintabellen> dct:hasPart ?domeintabel.
          ?domeintabel rdfs:label ?domeintabel_label
        }
      }
    """
  .

  config:DomeintabelHistorieData a elmo:InformationProduct;
    elmo:requiredParameter elmo:SubjectParameter;
    elmo:backend config:LocalBackend;
    elmo:query """
      PREFIX dct: <http://purl.org/dc/terms/>
      PREFIX prov: <http://www.w3.org/ns/prov#>
      PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
      PREFIX skos: <http://www.w3.org/2004/02/skos/core#>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      PREFIX owl:<http://www.w3.org/2002/07/owl#>
      PREFIX aquo: <http://standaard.aquo.nl/def/aquo#>

      CONSTRUCT {
        ?id ?p ?o;
            skos:comment ?status;
            owl:sameAs ?begrip;
            aquo:opgeheven ?opgehevendate;
             aquo:opgericht ?opgerichtdate.
        ?begrip  rdfs:label ?begrip_label.
        ?o rdfs:label ?olabel
      }
      WHERE {
        {
          GRAPH ?subject {
            ?id ?p ?o
            OPTIONAL {?o skos:prefLabel ?olabel}
            OPTIONAL {
              ?id aquo:Opgeheven_per ?dt;
                aquo:Opgericht_in ?odt.
              BIND(strbefore(?dt,"T") as ?opgehevendate)
              BIND(strbefore(?odt,"T") as ?opgerichtdate)
            }
            FILTER NOT EXISTS {
              ?id a skos:Concept.
            }
          }
          OPTIONAL {
            GRAPH <http://standaard.aquo.nl/id/dataset/links> {
              ?id owl:sameAs ?begrip
            }
            GRAPH  <http://standaard.aquo.nl/data/begrippen> {
              ?begrip skos:prefLabel ?begrip_label
            }
          }
        }

        UNION
        {
          GRAPH ?historic {
            ?historic dct:replacedBy ?subject.
            ?id ?p ?o.
            OPTIONAL {?id prov:invalidatedAtTime ?einddatum}
            FILTER (?id!=?historic)
          }
        }
        BIND(IF(BOUND(?einddatum), "historisch","gepubliceerd") as ?status)
        FILTER (?p != aquo:Opgeheven_per
          && ?p != aquo:Opgericht_in
        )
      }
    """
  .

  config:DomeinTitelData a elmo:InformationProduct;
      elmo:backend config:LocalBackend;
      elmo:requiredParameter elmo:SubjectParameter;
      elmo:query """
        PREFIX dct: <http://purl.org/dc/terms/>
        PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
        PREFIX dcat: <http://www.w3.org/ns/dcat#>

        SELECT ?metadata ?metadata_label ?beheerder ?beheerder_label
        WHERE {
          GRAPH <http://standaard.aquo.nl/data/domeintabellen> {
            <http://standaard.aquo.nl/id/dataset/domeintabellen> dct:hasPart ?metadata.
            ?metadata rdfs:label ?metadata_label.
            FILTER (?metadata = ?subject)
          }
          OPTIONAL {
            GRAPH <http://standaard.aquo.nl/data/domeintabelmetadata> {
              ?dataset dcat:distribution ?dist.
              ?dataset dct:publisher ?beheerder.
              ?beheerder rdfs:label ?beheerder_label.
              FILTER (?dist = ?subject)
            }
          }
        }
      """
    .

  config:DomeintabelStagingData a elmo:InformationProduct;
    elmo:backend config:LocalBackend;
    elmo:requiredParameter elmo:SubjectParameter;
    elmo:query """
      PREFIX aquo: <http://standaard.aquo.nl/def/aquo#>
      PREFIX prov: <http://www.w3.org/ns/prov#>
      CONSTRUCT {
        ?s ?p ?o;
         aquo:status ?status.
      }
      WHERE {
        {
          {
            SELECT ?s ?p ?o ("Verwijderen" as ?status)
            WHERE {
              BIND (iri(concat(str(?subject),"#staging")) as ?staging)
              GRAPH ?subject {
                ?s ?p ?o.
              }
              GRAPH ?staging {
                ?s prov:invalidatedAtTime ?t
              }
            }
          }
          UNION
          {
            SELECT (iri(concat(str(?sold),"#old")) as ?s) ?p ?o ("Wijzigen" as ?status)
            WHERE {
              BIND (iri(concat(str(?subject),"#staging")) as ?staging)
              GRAPH ?subject {
                ?sold ?p ?o.
              }
              GRAPH ?staging {
                ?sold a ?t
              }
            }
          }
          UNION
          {
            SELECT ?s ?p ?o ("Wijzigen in" as ?status)
            WHERE {
              BIND (iri(concat(str(?subject),"#staging")) as ?staging)
              GRAPH ?staging {
                ?s a ?t.
                ?s ?p ?o
              }
              FILTER EXISTS {
                GRAPH ?subject {
                  ?s a ?t.
                }
              }
            }
          }
          UNION
          {
            SELECT ?s ?p ?o ("Toevoegen" as ?status)
            WHERE {
              BIND (iri(concat(str(?subject),"#staging")) as ?staging)
              GRAPH ?staging {
                ?s ?p ?o
              }
              FILTER NOT EXISTS {
                GRAPH ?subject {
                  ?s a ?t.
                }
              }
            }
          }
        }
      }
    """;
  .

}
