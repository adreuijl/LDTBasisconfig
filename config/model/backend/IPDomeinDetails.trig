GRAPH config:Theatre {

  config:DomeintabelData a elmo:InformationProduct;
    elmo:requiredParameter elmo:SubjectParameter;
    elmo:backend config:LocalBackend;
    elmo:query """
      PREFIX dct: <http://purl.org/dc/terms/>
      PREFIX prov: <http://www.w3.org/ns/prov#>
      PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
      PREFIX skos: <http://www.w3.org/2004/02/skos/core#>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      PREFIX owl:<http://www.w3.org/2002/07/owl#>
      PREFIX aquo: <http://standaard.aquo.nl/def/aquo#>
      PREFIX dcmiperiod: <http://dublincore.org/documents/2006/04/10/dcmi-period/>
      PREFIX foaf: <http://xmlns.com/foaf/0.1/>
      prefix xsd:   <http://www.w3.org/2001/XMLSchema#>
      PREFIX dcat: <http://www.w3.org/ns/dcat#>
      CONSTRUCT {
        ?id ?p ?o;
          owl:sameAs ?begrip;
          aquo:opgeheven ?opgehevendate;
          aquo:opgericht ?opgerichtdate;
          dcmiperiod:start ?start.
        ?begrip rdfs:label ?begrip_label.
        ?o rdfs:label ?olabel.
      }
      WHERE {
        GRAPH ?domeingraph {
          ?id ?p ?o;
            a ?type;
            foaf:isPrimaryTopicOf/dct:temporal/dcmiperiod:start ?start.
          FILTER (?type != prov:Entity)
          FILTER NOT EXISTS {
            ?id foaf:isPrimaryTopicOf/dct:temporal/dcmiperiod:end ?einde.
            FILTER (now() > xsd:dateTime(concat(str(?einde),"T00:00:00")))
          }
          OPTIONAL {
            ?id aquo:Opgeheven_per ?dt;
              aquo:Opgericht_in ?odt.
            BIND(strbefore(?dt,"T") as ?opgehevendate)
            BIND(strbefore(?odt,"T") as ?opgerichtdate)
          }
          OPTIONAL {
            ?o rdfs:label ?olabel
          }
          FILTER NOT EXISTS {
              ?id a skos:Concept.
          }
        }
        GRAPH <http://standaard.aquo.nl/data/domeintabellen> {
          <http://standaard.aquo.nl/id/dataset/domeintabellen> dct:hasPart ?subject.
        }
        GRAPH <http://standaard.aquo.nl/data/domeintabelmetadata> {
            ?subject dcat:landingPage ?domeingraph
        }
        OPTIONAL {
          GRAPH <http://standaard.aquo.nl/data/links> {
            ?id owl:sameAs ?begrip
          }
          GRAPH  <http://standaard.aquo.nl/data/begrippen> {
            ?begrip skos:prefLabel ?begrip_label
          }
        }
        
        FILTER (
          ?p != aquo:Opgeheven_per
          && ?p != aquo:Opgericht_in
          && ?p != foaf:isPrimaryTopicOf
          && ?p != rdf:type
        )
      }
    """
  .

  # Mooier zou zijn als deze geintegreerd is met bovenstaande
  # Echter, op dit moment is het alleen mogelijk om groep in de subject parameter te stoppen
  # En daarmee past het niet bij het model van hierboven :-(
  config:DomeintabelGroepData a elmo:InformationProduct;
    elmo:requiredParameter elmo:SubjectParameter;
    elmo:backend config:LocalBackend;
    elmo:query """
      PREFIX dct: <http://purl.org/dc/terms/>
      PREFIX prov: <http://www.w3.org/ns/prov#>
      PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
      PREFIX skos: <http://www.w3.org/2004/02/skos/core#>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      PREFIX owl:<http://www.w3.org/2002/07/owl#>
      PREFIX foaf: <http://xmlns.com/foaf/0.1/>

      CONSTRUCT {
        ?id ?p ?o;
          owl:sameAs ?begrip;
          skos:comment ?status.
        ?begrip rdfs:label ?begrip_label.
        ?o rdfs:label ?olabel.
      }
      WHERE {
        GRAPH ?domeintabel {
          ?id dct:type ?subject;
            ?p ?o.
          OPTIONAL {?o rdfs:label ?olabel}
        }
        OPTIONAL {
          GRAPH <http://standaard.aquo.nl/data/links> {
            ?id owl:sameAs ?begrip
          }
          GRAPH  <http://standaard.aquo.nl/data/begrippen> {
            ?begrip skos:prefLabel ?begrip_label
          }
        }
        FILTER (
          ?p != rdf:type
          && ?p != foaf:isPrimaryTopicOf
        )
      }
    """
  .

  config:DomeintabelGroepTitelData a elmo:InformationProduct;
    elmo:requiredParameter elmo:SubjectParameter;
    elmo:backend config:LocalBackend;
    elmo:query """
      PREFIX dct: <http://purl.org/dc/terms/>
      PREFIX prov: <http://www.w3.org/ns/prov#>
      PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
      PREFIX skos: <http://www.w3.org/2004/02/skos/core#>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      PREFIX owl:<http://www.w3.org/2002/07/owl#>
      PREFIX foaf: <http://xmlns.com/foaf/0.1/>
      PREFIX dcat: <http://www.w3.org/ns/dcat#>

      SELECT
        ?subject ?subject_label ?domeintabel ?domeintabel_label
        
      WHERE {
        GRAPH ?domeintabelgraph {
          ?subject rdfs:label ?subject_label.
        }
        GRAPH <http://standaard.aquo.nl/data/domeintabelmetadata> {
          ?domeintabel dcat:landingPage ?domeintabelgraph;
           	rdfs:label ?domeintabel_label.
        }
      }
    """
  .

  config:DomeintabelHistorieData a elmo:InformationProduct;
    elmo:requiredParameter elmo:SubjectParameter;
    elmo:backend config:LocalBackend;
    elmo:query """
      PREFIX dct: <http://purl.org/dc/terms/>
      PREFIX prov: <http://www.w3.org/ns/prov#>
      PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
      PREFIX skos: <http://www.w3.org/2004/02/skos/core#>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      PREFIX owl:<http://www.w3.org/2002/07/owl#>
      PREFIX aquo: <http://standaard.aquo.nl/def/aquo#>
      PREFIX dcmiperiod: <http://dublincore.org/documents/2006/04/10/dcmi-period/>
      PREFIX foaf: <http://xmlns.com/foaf/0.1/>
      prefix xsd:   <http://www.w3.org/2001/XMLSchema#>
      PREFIX dcat: <http://www.w3.org/ns/dcat#>
      PREFIX adms: <http://www.w3.org/ns/adms#>
      CONSTRUCT {
        ?id ?p ?o;
          owl:sameAs ?begrip;
          aquo:opgeheven ?opgehevendate;
          aquo:opgericht ?opgerichtdate;
          dcmiperiod:start ?start;
          dcmiperiod:end ?einde;
          adms:status ?status.
        ?begrip rdfs:label ?begrip_label.
        ?o rdfs:label ?olabel.
      }
      WHERE {
        GRAPH ?domeingraph {
          ?id ?p ?o;
            a ?type;
            foaf:isPrimaryTopicOf/dct:temporal/dcmiperiod:start ?start.
          OPTIONAL {
            ?id foaf:isPrimaryTopicOf/dct:temporal/dcmiperiod:end ?einde.
          }
          BIND(IF(BOUND(?einde), "historisch","gepubliceerd") as ?status)
          FILTER (?type != prov:Entity)
          OPTIONAL {
            ?id aquo:Opgeheven_per ?dt;
              aquo:Opgericht_in ?odt.
            BIND(strbefore(?dt,"T") as ?opgehevendate)
            BIND(strbefore(?odt,"T") as ?opgerichtdate)
          }
          OPTIONAL {
            ?o skos:prefLabel ?olabel
          }
          FILTER NOT EXISTS {
              ?id a skos:Concept.
          }
        }
        GRAPH <http://standaard.aquo.nl/data/domeintabellen> {
          <http://standaard.aquo.nl/id/dataset/domeintabellen> dct:hasPart ?subject.
        }
        GRAPH <http://standaard.aquo.nl/data/domeintabelmetadata> {
            ?subject dcat:landingPage ?domeingraph
        }
        OPTIONAL {
          GRAPH <http://standaard.aquo.nl/data/links> {
            ?id owl:sameAs ?begrip
          }
          GRAPH  <http://standaard.aquo.nl/data/begrippen> {
            ?begrip skos:prefLabel ?begrip_label
          }
        }
        
        FILTER (
          ?p != aquo:Opgeheven_per
          && ?p != aquo:Opgericht_in
          && ?p != foaf:isPrimaryTopicOf
          && ?p != rdf:type
        )
      }
    """
  .

  config:DomeinTitelData a elmo:InformationProduct;
      elmo:backend config:LocalBackend;
      elmo:requiredParameter elmo:SubjectParameter;
      elmo:query """
        PREFIX dct: <http://purl.org/dc/terms/>
        PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
        PREFIX dcat: <http://www.w3.org/ns/dcat#>

        SELECT ?subject ?subject_label ?beheerder ?beheerder_label
        WHERE {
          GRAPH <http://standaard.aquo.nl/data/domeintabelmetadata> {
            ?subject rdfs:label ?subject_label.
            OPTIONAL {
              ?subject dct:publisher ?beheerder.
              ?beheerder rdfs:label ?beheerder_label.
            }
          }
        }
      """
    .

  config:DomeintabelStagingData a elmo:InformationProduct;
    elmo:backend config:LocalBackend;
    elmo:requiredParameter elmo:SubjectParameter;
    elmo:query """
      PREFIX aquo: <http://standaard.aquo.nl/def/aquo#>
      PREFIX prov: <http://www.w3.org/ns/prov#>
      CONSTRUCT {
        ?s ?p ?o;
         aquo:status ?status.
      }
      WHERE {
        {
          {
            SELECT ?s ?p ?o ("Verwijderen" as ?status)
            WHERE {
              BIND (iri(concat(str(?subject),"#staging")) as ?staging)
              GRAPH ?subject {
                ?s ?p ?o.
              }
              GRAPH ?staging {
                ?s prov:invalidatedAtTime ?t
              }
            }
          }
          UNION
          {
            SELECT (iri(concat(str(?sold),"#old")) as ?s) ?p ?o ("Wijzigen" as ?status)
            WHERE {
              BIND (iri(concat(str(?subject),"#staging")) as ?staging)
              GRAPH ?subject {
                ?sold ?p ?o.
              }
              GRAPH ?staging {
                ?sold a ?t
              }
            }
          }
          UNION
          {
            SELECT ?s ?p ?o ("Wijzigen in" as ?status)
            WHERE {
              BIND (iri(concat(str(?subject),"#staging")) as ?staging)
              GRAPH ?staging {
                ?s a ?t.
                ?s ?p ?o
              }
              FILTER EXISTS {
                GRAPH ?subject {
                  ?s a ?t.
                }
              }
            }
          }
          UNION
          {
            SELECT ?s ?p ?o ("Toevoegen" as ?status)
            WHERE {
              BIND (iri(concat(str(?subject),"#staging")) as ?staging)
              GRAPH ?staging {
                ?s ?p ?o
              }
              FILTER NOT EXISTS {
                GRAPH ?subject {
                  ?s a ?t.
                }
              }
            }
          }
        }
      }
    """;
  .

}
