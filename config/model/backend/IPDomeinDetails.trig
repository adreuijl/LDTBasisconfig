GRAPH config:Theatre {

  # Tijdelijk, om fout in LDT 1.x op te lossen: CONSTRUCT met tabel gaat niet goed!
  config:DomeintabelDataTemp a elmo:InformationProduct;
    elmo:requiredParameter elmo:SubjectParameter;
    elmo:resultType elmo-rt:Tuple;
    elmo:backend config:LocalBackend;
    elmo:query """
      PREFIX dct: <http://purl.org/dc/terms/>
      PREFIX prov: <http://www.w3.org/ns/prov#>
      PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
      PREFIX skos: <http://www.w3.org/2004/02/skos/core#>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      PREFIX aquo: <http://data.aquo.nl/def/aquo#>
      SELECT ?ID ?Code ?Omschrijving ?Afkorting ?Groep ?Groep_label ?begindate ?enddate
      WHERE {
        {
          GRAPH ?subject {
            ?id dct:identifier ?ID.
            ?id aquo:Omschrijving ?Omschrijving.
            ?id prov:generatedAtTime ?begindate
            OPTIONAL {?id aquo:Code ?Code}
            OPTIONAL {?id aquo:Afkorting ?Afkorting}
            OPTIONAL {?id aquo:Cijfercode ?Cijfercode}
            OPTIONAL {
              ?id dct:subject ?Groep.
              ?Groep skos:prefLabel ?Groep_label
            }
          }
        }
        UNION
        {
          GRAPH ?historic {
            ?historic dct:replacedBy ?subject.
            ?id dct:identifier ?ID.
            ?id aquo:Omschrijving ?Omschrijving.
            ?id prov:generatedAtTime ?begindate.
            ?id prov:invalidatedAtTime ?enddate.
            OPTIONAL {?id aquo:Code ?Code}
            OPTIONAL {?id aquo:Afkorting ?Afkorting}
            OPTIONAL {?id aquo:Cijfercode ?Cijfercode}
            FILTER (?id!=?historic)
          }
        }
      }
      ORDER BY ?ID
    """
  .

  config:DomeintabelData a elmo:InformationProduct;
    elmo:requiredParameter elmo:SubjectParameter;
    elmo:backend config:LocalBackend;
    elmo:query """
      PREFIX dct: <http://purl.org/dc/terms/>
      PREFIX prov: <http://www.w3.org/ns/prov#>
      PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
      PREFIX skos: <http://www.w3.org/2004/02/skos/core#>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
     
      CONSTRUCT {
        ?id ?p ?o;
            skos:comment ?status.
        ?o rdfs:label ?olabel
      }
      WHERE {
        {
          GRAPH ?subject {
            ?id ?p ?o
            OPTIONAL {?o skos:prefLabel ?olabel}
            FILTER NOT EXISTS {
              ?id a skos:Concept.
            }

          }
        }
        UNION
        {
          GRAPH ?historic {
            ?historic dct:replacedBy ?subject.
            ?id ?p ?o.
            OPTIONAL {?id prov:invalidatedAtTime ?einddatum}
            FILTER (?id!=?historic)
          }
        }
        BIND(IF(BOUND(?einddatum), "historisch","gepubliceerd") as ?status)
      }
    """
  .
    
  config:DomeinTitelData a elmo:InformationProduct;
      elmo:backend config:LocalBackend;
      elmo:requiredParameter elmo:SubjectParameter;
      elmo:query """
        PREFIX dct: <http://purl.org/dc/terms/>
        PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
       
        CONSTRUCT {
          ?subject dct:hasPart <http://data.aquo.nl/id/dataset/domeintabel> .
            #?subject rdf:type rdf:resource.
            ?subject rdfs:label ?dlabel.}        
        WHERE {
          GRAPH <http://data.aquo.nl/id/dataset/domeintabel> {
           <http://data.aquo.nl/id/dataset/domeintabel> dct:hasPart ?subject.
            ?subject rdfs:label ?label
          }
           BIND(CONCAT("Domein: ", ?label) AS ?dlabel)
         }
      
        
      """
    .
    
  config:DomeintabelStagingData a elmo:InformationProduct;
    elmo:backend config:LocalBackend;
    elmo:requiredParameter elmo:SubjectParameter;
    elmo:query """
      PREFIX aquo: <http://data.aquo.nl/def/aquo#>
      PREFIX prov: <http://www.w3.org/ns/prov#>
      CONSTRUCT {
        ?s ?p ?o.
        ?s aquo:status ?status.
      }
      WHERE {
        {
          {
            select ?s ?p ?o ("Verwijderen" as ?status)
            where {
              BIND (iri(concat(str(?subject),"#staging")) as ?staging)
              graph ?subject {
                ?s ?p ?o.
              }
              graph ?staging {
                ?s prov:invalidatedAtTime ?t
              }
            }
          }
          UNION
          {
            select (iri(concat(str(?sold),"#old")) as ?s) ?p ?o ("Wijzigen" as ?status)
            where {
              BIND (iri(concat(str(?subject),"#staging")) as ?staging)
              graph ?subject {
                ?sold ?p ?o.
              }
              graph ?staging {
                ?sold a ?t
              }
            }
          }
          UNION
          {
            select ?s ?p ?o ("Wijzigen in" as ?status)
            where {
              BIND (iri(concat(str(?subject),"#staging")) as ?staging)
              graph ?staging {
                ?s a ?t.
                ?s ?p ?o
              }
              FILTER EXISTS {
                graph ?subject {
                  ?s a ?t.
                }
              }
            }
          }
          UNION
          {
            select ?s ?p ?o ("Toevoegen" as ?status)
            where {
              BIND (iri(concat(str(?subject),"#staging")) as ?staging)
              graph ?staging {
                ?s ?p ?o
              }
              FILTER NOT EXISTS {
                graph ?subject {
                  ?s a ?t.
                }
              }
            }
          }
        }
      }
    """;
  .
 
}